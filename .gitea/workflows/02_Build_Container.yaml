name: build and push dockerfiles
on: 
  workflow_dispatch: 

jobs:
  build_and_push:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v5

      - name: Log in to container registry
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_USER }}
          password: ${{ secrets.DOCKER_SECRET }}

      - name: Build and push Docker image A
        uses: docker/build-push-action@v5
        with:
          context: .
          file: ./cmd/api-service/Dockerfile
          push: true
          tags: |
            samatgaripov/api-service:latest
            samatgaripov/api-service:v1.0.1
      
      - name: Build and push Docker image B
        uses: docker/build-push-action@v5
        with:
          context: .
          file: ./cmd/info-service/Dockerfile
          push: true
          tags: |
            samatgaripov/api-info:latest
            samatgaripov/api-info:v1.0.1
      - name: Build and push Docker image C
        uses: docker/build-push-action@v5
        with:
          context: .
          file: ./cmd/login-service/Dockerfile
          push: true
          tags: |
            samatgaripov/api-login:latest
            samatgaripov/api-login:v1.0.1
      
      - name: Build and push Docker image D
        uses: docker/build-push-action@v5
        with:
          context: .
          file: ./cmd/root-service/Dockerfile
          push: true
          tags: |
            samatgaripov/api-root:latest
            samatgaripov/api-root:v1.0.1
      - name: Job status
        run: echo "This job's status is ${{ job.status }}."